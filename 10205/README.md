Good example of OrderedDict, generator and nested def.